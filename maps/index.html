<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAVEMAN Maps</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../style.css" />
    <link href="https://fonts.googleapis.com/css?family=Raleway:300,400" rel="stylesheet" />
    <style>
		body {
			background-color: #191919;
			color: #FFF;
		}

        .card {
            margin: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
			background-color: #053163;
			color: #FFF;
			align-self: center;
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .card-img-top {
            height: 180px;
            object-fit: cover;
        }
        .carousel-control-prev, 
        .carousel-control-next {
            width: 40px;
            height: 40px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
        }
        .carousel-inner {
            padding: 1rem 0;
        }
        .card-title {
            font-weight: 600;
        }
        .btn-primary {
            background-color: #000;
            border: none;
        }
        .btn-primary:hover {
            background-color: #0b5ed7;
        }
        .carousel-indicators {
            position: relative;
            margin-top: 20px;
        }
        .carousel-indicators [data-bs-target] {
            background-color: #555;
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        #carouselCards {
            margin-bottom: 50px;
        }
    </style>
</head>
<body>
    <main>
        <div id="headerroot"></div>
        <div class="container py-4">            
            <div id="carouselCards" class="carousel slide" data-bs-ride="carousel" data-bs-pause="false">
                <div class="carousel-inner">
                    <!-- Dynamic slides will be inserted here by JavaScript -->
                </div>
                
                <!-- Carousel controls -->
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselCards" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselCards" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
                
                <!-- Carousel indicators will be added dynamically -->
                <div class="carousel-indicators"></div>
            </div>
        </div>

        <script defer type="module" src="../src/stdpageheader.jsx"></script>
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
        <script>
            // Card data
            const cardData = [
                {
                    title: "Enlow Tunnel",
                    image: "/images/thumbnail_elt.png",
                    alt: "Enlow Tunnel Textured Map",
                    description: "Enlow Tunnel on the Montour Trail in Coraopolis, PA, mapped by the CAVEMAN Rover! The best map attained yet!",
                    CAVeViewer: "/maps/enlowtunneltextured/",
                    vr_walkthrough: "enlowtunnelmodal",
                    embedded_youtube_link: "GMlwcKamOEM?si=6RpY7R4TxNMyAb_Z"
                },
                {
                    title: "Enlow Tunnel - Point Cloud Render",
                    image: "/images/thumbnail_eltpc.png",
                    alt: "Enlow Tunnel Textured Map from Point Cloud",
                    description: "Enlow Tunnel Reconstructed using Point Clouds and Poisson Reconstruction. Mapped by the CAVEMAN Rover!",
                    CAVeViewer: "/maps/enlowtunnelmeshlabpc/",
                    vr_walkthrough: -1,
                },
                {
                    title: "Enlow Tunnel - Less Textured",
                    image: "/images/thumbnail_cave.png",
                    alt: "Enlow Tunnel Lesser Textured Map",
                    description: "Enlow Tunnel on the Montour Trail mapped by the CAVEMAN Rover! This map has less textures due to different mapping pipeline configurations.",
                    CAVeViewer: "/maps/TheCave/",
                    vr_walkthrough: "enlowlt",
                    embedded_youtube_link: "UD9cPdoDOaY?si=nA1VZGz2keK51rNV"
                },
                {
                    title: "Floor 4 Benedum Hallway",
                    image: "/images/thumbnail_f4b.png",
                    alt: "Floor 4 Benedum Hallway",
                    description: "Floor 4 Benedum Hallway mapped by the CAVEMAN Rover!",
                    CAVeViewer: "/maps/Floor4Benedum/",
                    vr_walkthrough: "f4b",
                    embedded_youtube_link: "ccKx-MKUHWE?si=lID9MbRekx8LFtJ3"
                },
                {
                    title: "Floor 4 Benedum Hallway - Again",
                    image: "/images/thumbnail_beh4be.png",
                    alt: "BEH Floor 4 Hallway",
                    description: "Floor 4 Benedum Hallway mapped by the CAVEMAN Rover!",
                    CAVeViewer: "/maps/BEH4HallwayBE/",
                    vr_walkthrough: -1,
                },
                {
                    title: "Floor 4 Benedum Hallway - Low Exposure",
                    image: "/images/thumbnail_f4bhle.png",
                    alt: "Floor 4 Benedum Hallway - Low Exposure",
                    description: "Floor 4 Benedum Hallway mapped by the CAVEMAN Rover! The camera settings had less than ideal exposure.",
                    CAVeViewer: "/maps/Floor4BenedumLE/",
                    vr_walkthrough: "f4bh",
                    embedded_youtube_link: "gz_Dc18q1rU?si=ni_MnHWvOHYknKmW"
                },
                {
                    title: "Diulus Hallway",
                    image: "/images/thumbnail_diulus.png",
                    alt: "Diulus Hallway",
                    description: "Hallway within an off-campus house. Mapped using an iPhone 13.",
                    CAVeViewer: "/maps/DiulusHallway/",
                    vr_walkthrough: "diulus",
                    embedded_youtube_link: "EMApm7vezO4?si=V5TSRdAv8b0Cd4a6"
                },
                {
                    title: "Desk Setup",
                    image: "/images/thumbnail_437desk.png",
                    alt: "Enlow Tunnel Textured Map",
                    description: "Desk Setup in BEH437 mapped using RTABMAP Texturing Output",
                    CAVeViewer: "/maps/desksetup437/",
                    vr_walkthrough: "desksetup",
                    embedded_youtube_link: "iMXw1UMdLZA?si=6sG3ROV3H-kilYlE"
                },
                {
                    title: "Another Floor 4 Benedum Hallway - Low Exposure",
                    image: "/images/thumbnail_f4bmeh.png",
                    alt: "Another Floor 4 Benedum Hallway",
                    description: "This is a low exposure hallway on Benedum's 4th floor, mapped by the CAVEMAN Rover!",
                    CAVeViewer: "/maps/Floor4BenedumLEmeh/",
                    vr_walkthrough: -1,
                },
                {
                    title: "Tunnel of Sorts",
                    image: "/images/thumbnail_tunnel.png",
                    alt: "Tunnel of Sorts",
                    description: "Entrance of Enlow Tunnel with minimal texture, mapped by the CAVEMAN Rover!",
                    CAVeViewer: "/maps/tunnelquestionmark/",
                    vr_walkthrough: -1,
                }
            ];

            var carousel;

            // Function to create a card element
            function createCard(cardInfo) {
                let card = `
                    <div class="card overflow-auto" style="width: 18rem; height: 60vh; justify-content: center; align-items: center; text-align: center;">
                        <img src="${cardInfo.image}" class="card-img-top" alt="${cardInfo.alt}">
                        <div class="card-body">
                            <h5 class="card-title" style="height: 15%;">${cardInfo.title}</h5>
                            <p class="card-text" style="height: 50%;">${cardInfo.description}</p>
                            <div class="d-grid gap-2 mx-autod-grid align-items-center" style="height: 20%;">
                                <a href="${cardInfo.CAVeViewer}" class="btn btn-primary btn-block text-center">View in CAVeViewer</a>
                `

                if(cardInfo.vr_walkthrough != -1)
                {
                    card += `<a href="" data-bs-toggle="modal" data-bs-target="#${cardInfo.vr_walkthrough}" class="btn btn-primary btn-block">View VR Walkthrough</a>`
                }

                card += `</div>
                        </div>
                    </div>
                `
                
                if(cardInfo.vr_walkthrough != -1)
                {
                    card += `<div class="modal fade" id="${cardInfo.vr_walkthrough}" tabindex="-1" aria-labelledby="${cardInfo.vr_walkthrough}" aria-hidden="true">
                                <button type="button" class="btn-close fixed-close" data-bs-dismiss="modal" aria-label="Close video"></button>
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-body p-0">
                                            <div class="video-container">
                                                <iframe src="https://www.youtube.com/embed/${cardInfo.embedded_youtube_link}" 
                                                        title="YouTube video player" 
                                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                                        allowfullscreen>
                                                </iframe>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>`
                }
                
                return card;
            }

            function videoModalLogic(cardInfo) {
                if(cardInfo.vr_walkthrough != -1)
                {

                    document.getElementById(cardInfo.vr_walkthrough).addEventListener('hidden.bs.modal', function () {
                        const iframe = this.querySelector('iframe');
                        const src = iframe.src;
                        iframe.src = '';
                        iframe.src = src;
                        carousel.cycle();
                    });
                }
            }

            document.addEventListener('show.bs.modal', function () {
                console.log("entered event");
                const carouselElem = document.getElementById('carouselCards');
                carousel = bootstrap.Carousel.getInstance(carouselElem);
                console.log(carousel);
                if(!(carousel === null)){
                    carousel.pause();
                    // carousel.interval(false);
                    console.log("Persistent Carousel paused");
                }

                carousel = new bootstrap.Carousel(carouselElem, {
                    pause: false
                });
                carousel.pause();
                console.log(carousel);
            });

            // Function to dynamically organize cards based on screen width
            function organizeCarouselItems() {
                const carouselInner = document.querySelector('.carousel-inner');
                const indicatorsContainer = document.querySelector('.carousel-indicators');
                carouselInner.innerHTML = '';
                indicatorsContainer.innerHTML = '';
                
                // Determine number of cards per slide based on screen width
                let cardsPerSlide;
                if (window.innerWidth < 768) {
                    cardsPerSlide = 1; // Mobile: 1 card per slide
                } else if (window.innerWidth < 992) {
                    cardsPerSlide = 2; // Tablet: 2 cards per slide
                } else {
                    cardsPerSlide = 3; // Desktop: 3 cards per slide
                }
                
                // Calculate number of slides needed
                const totalSlides = Math.ceil(cardData.length / cardsPerSlide);
                
                // Create slides
                for (let i = 0; i < totalSlides; i++) {
                    const slideDiv = document.createElement('div');
                    slideDiv.className = `carousel-item ${i === 0 ? 'active' : ''}`;
                    
                    const cardContainer = document.createElement('div');
                    cardContainer.className = 'd-flex justify-content-center flex-wrap';
                    
                    // Add cards to this slide
                    for (let j = 0; j < cardsPerSlide; j++) {
                        const cardIndex = i * cardsPerSlide + j;
                        if (cardIndex < cardData.length) {
                            cardContainer.innerHTML += createCard(cardData[cardIndex]);
                        }
                    }
                    
                    slideDiv.appendChild(cardContainer);
                    carouselInner.appendChild(slideDiv);
                    
                    // Create indicator for this slide
                    const indicator = document.createElement('button');
                    indicator.setAttribute('type', 'button');
                    indicator.setAttribute('data-bs-target', '#carouselCards');
                    indicator.setAttribute('data-bs-slide-to', i.toString());
                    if (i === 0) {
                        indicator.setAttribute('aria-current', 'true');
                        indicator.className = 'active';
                    }
                    indicator.setAttribute('aria-label', `Slide ${i + 1}`);
                    indicatorsContainer.appendChild(indicator);
                }

                for (let cardIndex = 0; cardIndex < cardData.length; cardIndex++)
                {
                    videoModalLogic(cardData[cardIndex]);
                }
            }

            // Run on page load
            document.addEventListener('DOMContentLoaded', organizeCarouselItems);
            
            // Run when window is resized
            window.addEventListener('resize', organizeCarouselItems);
        </script>
    </main>
</body>
</html>